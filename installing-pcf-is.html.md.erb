---
title: Installing Pivotal Isolation Segment
owner: RelEng
deployment: IST
---

This topic describes how to install the <%= vars.segment_runtime_full %> tile, which allows operators to isolate deployment workloads into dedicated resource pools called _isolation segments_.

Installing the tile installs a single isolation segment. However, you can install multiple isolation segments using the Replicator tool documented in [Step 4](#copy).

After installing the tile, you must follow the procedure in the [Create an Isolation Segment](../adminguide/isolation-segments.html#create-an-is) section of the _Managing Isolation Segments_ topic to create the isolation segment in the Cloud Controller database (CCDB). The topic also includes information about managing an isolation segment.

For more information about how isolation segments work, see the [Isolation Segments](../concepts/security.html#isolation-segments) section of the _<%= vars.app_runtime_abbr %> Security_ topic.


## <a id='routing'></a> Step 1: (Optional) Configure Routing

By default, the <%= vars.app_runtime_full %> (<%= vars.app_runtime_abbr %>) Gorouter handles traffic for your isolation segment. However, you can deploy a dedicated router for your isolation segment instead. For information about configuring and managing routing for isolation segments, see [Routing for Isolation Segments](../adminguide/routing-is.html).

To deploy a dedicated router:

1. Add a load balancer in front of the <%= vars.app_runtime_abbr %> Gorouter. The steps to do this depend on your IaaS, but the setup of the load balancer should mirror the setup of the load balancer for the <%= vars.app_runtime_abbr %> Gorouter that you configured in the <%= vars.app_runtime_abbr %> tile.

1. Create a wildcard DNS entry for traffic routed to any app in the isolation segment. For example, `*.iso.example.com`.

1. Attach the wildcard DNS entry to the load balancer you created.


## <a id='install'></a> Step 2: Install the Tile

To install the <%= vars.segment_runtime_full %> tile:

1. Download the product file from the [<%= vars.segment_runtime_full %>](https://network.pivotal.io/products/isolation-segment) page of Pivotal Network.

1. Navigate to your Ops Manager URL in a browser to log in to the Ops Manager Installation Dashboard.

1. Click **Import a Product** and select the downloaded product file.

1. Under **<%= vars.segment_runtime_full %>** in the left column, click the **+** icon.


## <a id='config'></a> Step 3: Configure the Tile

Click the orange **<%= vars.segment_runtime_full %>** tile to start the configuration process.

### <a id='az_networks'></a> Assign AZs and Networks

In the **Assign AZ and Networks** pane, you assign jobs to your Availability Zones (AZs) and networks.

To configure the **Assign AZ and Networks** pane:

1. Select **Assign AZs and Networks**.

1. Select an AZ for your singleton jobs, and one or more AZs to balance other jobs in.

1. Select a network. This network does not need to be the same network where you deployed <%= vars.app_runtime_abbr %>. For most deployments, operators should create unique networks in which to deploy the <%= vars.segment_runtime_full %> tile. These networks should maintain network reach-ability with the Diego components so that the Diego Cells can reach the Diego Brain and Diego Database VMs.

1. Click **Save**.

### <a id='networking'></a> Networking

<%# Find this partial in GitHub at `pivotal-cf/docs-partials` %>
<%= partial "/pcf/core/#{vars.current_major_version.sub('.', '-')}/networking-is" %>

### <a id='application_containers'></a> App Containers

In the **App Containers** pane, you enable microservice frameworks, private Docker registries, and other services that support your apps at the container level.

To configure the **App Containers** pane:

1. Select **App Containers**.

1. <%# Find this partial in GitHub at `pivotal-cf/docs-partials` %><%= partial "/pcf/core/#{vars.current_major_version.sub('.', '-')}/router_app_identity_verification" %>

1. (Optional) You can configure <%= vars.app_runtime_abbr %> to run app instances in Docker containers by provided a comma-separated list of their IP address ranges in the **Private Docker insecure registry allow list** field. For more information, see [Using Docker Registries](../opsguide/docker-registry.html).

1. Under **Segment name**, enter the name of your isolation segment. This name must be unique across your <%= vars.platform_name %> deployment. You use this name when performing the steps in the [Create an Isolation Segment](../adminguide/isolation-segments.html#create-an-is) section of the _Managing Isolation Segments_ topic to create the isolation segment in the Cloud Controller database (CCDB).

1. Select your preference for **Docker images disk cleanup scheduling on Diego Cell VMs**. If you choose **Clean up disk space once usage fills disk**, enter a value in MB for **Reserved disk space for other jobs**. This is the amount of space the garbage collection algorithm should keep free for other jobs. For more information about the configuration options and how to configure a reserved amount, see [Configuring Diego Cell Disk Cleanup Scheduling](../opsguide/config-cell-cleanup.html).

1. The **Enable containerd delegation** checkbox governs whether or not Garden delegates container create and destroy operations to the containerd tool. By default, this option is enabled and Garden uses containerd. Disable this option by disabling the checkbox. For more information about the containerd tool, see [containerd](https://containerd.io).

1. Under **NFSv3 volume services**, select **Enable** or **Disable**. NFS volume services allow app developers to bind existing NFS volumes to their apps for shared file access. For more information, see [Enabling Volume Services](../opsguide/enable-vol-services.html).
  <p class="note"><strong>Note:</strong> In a fresh install, NFSv3 volume services is enabled by default. In an upgrade, NFSv3 volume services is set to the same setting as it was in the previous deployment.</p>

1. (Optional) To configure LDAP for NFSv3 volume services:
  * For **LDAP service account user**, enter the username of the service account in LDAP that manages volume services.
  * For **LDAP service account password**, enter the password for the service account.
  * For **LDAP server host**, enter the hostname or IP address of the LDAP server.
  * For **LDAP server port**, enter the LDAP server port number. If you do not specify a port number, Ops Manager uses 389.
  * For **LDAP user search base**, enter the location in the LDAP directory tree from which any LDAP user search begins. The typical LDAP search base matches your domain name. <br>For example, a domain named `cloud.example.com` typically uses the following LDAP user search base: `ou=Users,dc=example,dc=com`.
  * (Optional) For **LDAP server CA certificate**, you can enter a certificate if your LDAP server supports TLS and you want to enable TLS connections from the NFS driver to your LDAP server. Paste in the root certificate from your CA certificate or your self-signed certificate.
  <p class='note'><strong>Note:</strong> UAA can only parse one certificate entered into this field. If you enter multiple certificates, UAA only uses the first one you entered and ignores the rest. You only need to include one root certificate or self-signed certificate.</p>

1. (Optional) To limit the number of log lines each app instance in your isolation segment can generate per second, select **Enable** under **App log rate limit (beta)** and enter the **Maximum app log lines per second** you want to configure. At minimum, <%= vars.recommended_by %> recommends using the default limit of `100`. This feature is disabled by default. Disabling this feature may cause an app instance to overload the Loggregator Agent with logs, which may result in the Loggregator Agent dropping logs for other app instances. Otherwise, it may report inaccurate app metrics in the cf CLI or increase the CPU usage on the Diego Cell VM. If you configure a log rate limit, you can monitor the `AppInstanceExceededLogRateLimitCount` metric for the number of app instances that exceed the log rate limit.

1. Click **Save**.

### <a id='syslog'></a> System Logging

In the **System Logging** pane, you can configure system logging in <%= vars.app_runtime_abbr %> to forward log messages from <%= vars.app_runtime_abbr %> component VMs to an external service. <%= vars.recommended_by %> recommends forwarding logs to an external service for use in troubleshooting. If you do not fill these fields, platform logs are not forwarded but remain available on the component VMs and for download through Ops Manager.

To configure the **System Logging** pane:

1. Select **System Logging**.

1. Select an option under **Configure syslog for system components?**. **No** is selected by default. This setting only affects Diego Cell, Gorouter, and HAProxy components within the isolation segment. This setting does not affect shared <%= vars.app_runtime_abbr %> system components.

1. If you want to use syslog, select **Yes**.

1. Enter the address of your external syslog aggregation service in the **Address** field. The address can be a hostname or IP address.

1. Enter a port number in the **Port** field.

1. Select a protocol from the **Transport protocol** menu. This is the protocol the system uses to transmit logs to syslog.

1. (Optional) Select the **Enable TLS** checkbox if you want to transmit logs over TLS.

1. Enter a **Permitted peer**.

1. Paste the certificate for your TLS certificate authority (CA) in the **TLS CA certificate** field.

1. (Optional) Enable the **Use TCP for file forwarding local transport** checkbox to transmit logs over TCP. This prevents log truncation, but may cause performance issues.

1. (Optional) The **Do not forward debug logs** checkbox is enabled by default. To forward `DEBUG` syslog messages to an external service, disable the checkbox.
  <p class="note"><strong>Note:</strong> Some <%= vars.segment_runtime_full %> components generate a high volume of <code>DEBUG</code> syslog messages. Enabling the <strong>Do not forward debug logs</strong> checkbox prevents <%= vars.app_runtime_abbr %> components from forwarding the <code>DEBUG</code> syslog messages to external services. However, <%= vars.segment_runtime_full %> still writes the messages to the local disk.</p>

1. (Optional) To specify a custom syslog rule, enter it in the **Custom rsyslog configuration** field in RainerScript syntax. For more information about customizing syslog rules, see [Customizing Syslog Rules](./custom-syslog-rules.html). For more information about RainerScript, see the [RainerScript](http://www.rsyslog.com/doc/v8-stable/rainerscript/index.html) documentation.

1. Select the **Enable system metrics** checkbox to emit system-level metrics about all VMs in the deployment. For a list of the VM metrics that the System Metric Agent emits, see [VM Metrics](https://github.com/cloudfoundry/system-metrics-release/blob/develop/docs/system-metrics-agent.md#vm-metrics) in GitHub. When you enable this checkbox, ensure that you open port `9100` for the isolation segment. For more information, see the [Configure Firewall Rules](../adminguide/routing-is.html#config-firewall) section of the _Routing for Isolation Segments_ topic.

1. Click **Save.**

### <a id='advanced_features'></a> Advanced Features

<%# Find this partial in GitHub at `pivotal-cf/docs-partials` %>
<%= partial "/pcf/core/#{vars.current_major_version.sub('.', '-')}/advanced-features" %>

### <a id='resources'></a> Configure Router Resources

In the **Resource Config** pane, you must associate load balancers with the VMs in your deployment to enable traffic.

To configure the **Resource Config** pane:

1. Select **Resource Config**.

1. If you are using a dedicated router for your isolation segment, follow the instructions below.
  <p class="note"><strong>Note:</strong> The configuration settings available in <strong>Resource Config</strong> vary depending on your IaaS.</p>
  * **If you have the Load Balancers column in your Resource Config**:
      * Enter the wildcard DNS entry attached to your load balancer into the **Router** row under **Load Balancers**.
  * **If you do not have the Load Balancers column in your Resource Config**:
      * Navigate to the **Networking** section of the **<%= vars.segment_runtime_full %>** tile.
      * Specify **Router IPs**.
      * Attach the IP addresses to your load balancer manually.

1. If you are not using HAProxy for this isolation segment, set the number of **Instances** to `0`.

### <a id='compute-networking-isolation'></a> Compute and Networking Isolation

In the **Compute and Networking Isolation** pane, you can enable or disable compute isolation and configure router sharding for isolation segments. _Compute isolation_ is when an app runs on compute resources - such as clusters, resource pools, and servers - that are isolated from other resources by a network partition or firewall. _Networking isolation_, or router sharding, is when traffic to an app instance uses a dedicated route that is isolated from routes used by other app instances by a network partition or firewall rule.

In the <%= vars.segment_runtime_full %> tile, compute isolation and networking isolation must be configured or disabled simultaneously. This is because networking isolation configures the route by which traffic goes to the <%= vars.segment_runtime_full %> tile. Both are enabled by default.

To configure the **Compute and Networking Isolation** pane:

1. Select **Compute and Networking Isolation**.

1. Choose whether to enable or disable compute isolation under **Compute isolation**.
    * To disable compute isolation, select **Disable**. Select this option if you do not require compute isolation and you are deploying the <%= vars.segment_runtime_full %> tile for the purpose of making upgrades more manageable. For example, if you have a <%= vars.app_runtime_abbr %> tile with a large volume of Diego Cells. This approach helps separate the upgrade of the <%= vars.app_runtime_abbr %> control plane from the upgrade of the Diego Cells. Further, it splits the upgrade of the Diego Cells into smaller groups. 
    * To enable compute isolation, select **Enable** and enter a placement tag for your Diego Cells in the **Segment name** field. This placement tag identifies the Diego Cells that run in your isolation segment.
    <p class='note'><strong>Note:</strong> If you disable compute isolation, you must set <strong>Router sharding mode</strong> to <strong>No Isolation Segment</strong>.</p>

1. Enable or disable networking isolation by selecting a sharding mode under **Router sharding mode**. For more information, see the [Sharding Routers for Isolation Segments](../adminguide/routing-is.html#sharding-routers-isolation-segment) section of the _Routing for Isolation Segments_ topic.
  * **Isolation Segment only**: The routers for the tile acknowledge requests only from apps deployed within the Diego Cells of the tile. All other requests fail.
  * **No Isolation Segment**: The routers for the tile reject requests for any isolation segment. Choose this option to add a group of routers for the <%= vars.app_runtime_abbr %> tile, such as when you want a private point of entry for the system domain.

### <a id='after_config'></a> After Tile Configuration

After you configure the <%= vars.segment_runtime_full %> tile:

1. Create the isolation segment in the Cloud Controller database (CCDB) by following the procedure in the [Create an Isolation Segment](../adminguide/isolation-segments.html#create-an-is) section of the _Managing Isolation Segments_ topic. <p class='note'><strong>Note:</strong> If you have previously run the smoke tests as a post deployment errand, the isolation segment may have already been created for you.</p>

1. Return to the Ops Manager Installation Dashboard.

1. Click **Review Pending Changes**, then **Apply Changes** to deploy the tile.

After the tile finishes deploying, see [Managing Isolation Segments](../adminguide/isolation-segments.html) for more information about managing an isolation segment.


## <a id='copy'></a> (Optional) Step 4: Copy the Tile

If you want to create multiple isolation segments, you can copy the <%= vars.segment_runtime_full %> tile with the Replicator tool.

To create multiple isolation segments:

1. Download the Replicator tool from the **<%= vars.segment_runtime_full %>** page of [Pivotal Network](https://network.pivotal.io/products/isolation-segment).

1. Navigate to the directory where you downloaded the Replicator tool.

1. Replicate the tile by running:
	
    ```
  	./replicator \
      	--name "TILE-NAME" \
      	--path /PATH/TO/ORIGINAL.pivotal \
      	--output /PATH/TO/COPY.pivotal
  	```
    Where:
  	* `TILE-NAME` is a unique name you provide for the new <%= vars.segment_runtime_full %> tile. The name must be ten characters or less and only contain alphanumeric characters, dashes, underscores, and spaces.
  	* `/PATH/TO/ORIGINAL` is the absolute path to the original <%= vars.segment_runtime_full %> tile you downloaded from Pivotal Network.
  	* `/PATH/TO/COPY` is the absolute path for the copy that the Replicator tool produces.

1. Follow the procedures in this topic using the new `.pivotal` file, starting with [Step 1](#routing).

### <a id='upgrading-replicas'></a> Upgrading Replicated Tiles

For information about upgrading replicated <%= vars.segment_runtime_full %> tiles, see the [Upgrading Replicated Tiles](https://docs.pivotal.io/platform/<%= vars.current_major_version.sub('.', '-') %>/customizing/upgrading-products.html#replica-tiles) section of the _Upgrading <%= vars.app_runtime_abbr %> and Other Pivotal Platform Products_ topic.
